<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>BetterCrunchy PLUS</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --accent:#ff7a1a;
      --radius:12px;
      --bg:#0b0b0e;
      --card-bg:rgba(255,255,255,0.06);
      --elev:0 8px 24px rgba(0,0,0,.55);
      --elev-hover:0 14px 34px rgba(0,0,0,.6);
      --text:#f4f4f5;
      --muted:#b6b6c2;
      --outline:#23232a;
      --success:#27c37b;
      --danger:#ff4d4d;
      --warning:#ffcc00;
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#fbfbfe; --text:#111318; --muted:#5b5b6a; --card-bg:rgba(0,0,0,0.04); --outline:#e5e7ef; }
    }

    html,body{margin:0;padding:0;}
    body{
      font-family:'Inter',system-ui,Arial,sans-serif;
      width:340px; /* + more room */
      background:
        radial-gradient(1200px 400px at -10% -30%, rgba(255,122,26,.12), transparent 50%),
        radial-gradient(900px 300px at 120% 130%, rgba(255,122,26,.12), transparent 50%),
        var(--bg);
      color:var(--text);
      display:flex;flex-direction:column;align-items:stretch;
      border-radius: var(--radius);
      overflow: hidden;
    }

    header{
      position:sticky;top:0;z-index:5;
      display:flex;align-items:center;justify-content:space-between;gap:.8rem;
      padding:14px 16px;
      background:linear-gradient(135deg,var(--accent) 0%,color-mix(in oklab,var(--accent) 70%,white) 100%);
      color:#0a0a0a;
      border-bottom:1px solid rgba(255,255,255,.14);
    }
    header .brand{display:flex;align-items:center;gap:.6rem;}
    header img{width:24px;height:24px;border-radius:6px;}
    header h1{font-size:1.05rem;margin:0;font-weight:700;letter-spacing:.2px;}
    header .badges{display:flex;gap:6px;align-items:center;}
    .badge{font-size:.7rem;padding:4px 6px;border-radius:6px;background:rgba(0,0,0,.12)}

    .tabs{display:flex;gap:6px;padding:10px 10px 0;}
    .tab{flex:1;text-align:center;padding:8px 10px;border-radius:10px;cursor:pointer;color:var(--muted);user-select:none;border:1px solid transparent;}
    .tab[aria-selected="true"]{color:#0b0b0e;background:var(--accent);border-color:color-mix(in oklab,var(--accent) 70%, black 15%);} 

    main{padding:12px;display:flex;flex-direction:column;gap:12px;}

    .card{background:var(--card-bg);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:12px 12px;box-shadow:var(--elev);transition:transform .18s ease, box-shadow .18s ease, border-color .2s;}
    .card:hover{transform:translateY(-1px);box-shadow:var(--elev-hover);} 
    .card h3{margin:0 0 8px;font-size:.92rem;color:var(--accent);}

    .row{display:flex;justify-content:space-between;align-items:center;margin:6px 0;gap:12px;}
    .stack{display:flex;flex-direction:column;gap:2px;}
    .label{font-size:.92rem;}
    .hint{font-size:.78rem;color:var(--muted);} 
    .divider{height:1px;background:var(--outline);margin:8px 0;border-radius:1px;}

    /* Switch */
    .switch{position:relative;width:46px;height:26px;display:inline-block;}
    .switch input{opacity:0;width:0;height:0;position:absolute;}
    .slider{position:absolute;cursor:pointer;inset:0;background:#4a4a53;border-radius:26px;transition:.25s;box-shadow:inset 0 0 0 1px rgba(255,255,255,.06);} 
    .slider:before{content:"";position:absolute;height:22px;width:22px;left:2px;bottom:2px;background:white;border-radius:50%;transition:.25s;box-shadow:0 1px 2px rgba(0,0,0,.35);} 
    input:checked + .slider{background:linear-gradient(180deg,var(--accent), color-mix(in oklab, var(--accent) 70%, black));}
    input:checked + .slider:before{transform:translateX(20px);} 
    .switch:focus-within .slider{outline:2px solid rgba(255,255,255,.4);outline-offset:2px;border-radius:30px;} 

    /* Range */
    input[type=range]{-webkit-appearance:none;width:180px;height:6px;background:#3b3b42;border-radius:4px;outline:none;}
    input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;border-radius:50%;background:var(--accent);cursor:pointer;box-shadow:0 1px 2px rgba(0,0,0,.4);} 

    /* Select & Color */
    select, input[type=color]{background:#2f2f36;color:var(--text);border:1px solid #4d4d57;border-radius:8px;padding:8px 10px;font-size:.86rem;}
    input[type=color]{width:44px;height:30px;padding:0;border:none;border-radius:8px;}

    /* Buttons */
    .btn{margin-top:6px;width:100%;border:none;padding:10px 0;font-weight:700;border-radius:10px;color:#000;cursor:pointer;font-size:.9rem;transition:filter .15s, transform .02s;}
    .btn:hover{filter:brightness(1.06);} 
    .btn:active{transform:translateY(1px);} 
    .primary{background:var(--accent);} 
    .success{background:var(--success);}
    .danger{background:var(--danger);}

    .row-grid{display:grid;grid-template-columns:1fr auto;align-items:center;gap:10px;}

    footer{padding:10px 12px;color:var(--muted);font-size:.78rem;display:flex;justify-content:space-between;align-items:center;border-top:1px solid rgba(255,255,255,.06);} 
    a.link{color:var(--muted);text-decoration:none;}
    a.link:hover{text-decoration:underline;}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <img src="icons/logo.png" alt="Logo">
      <h1>BetterCrunchy</h1>
    </div>
    <div class="badges">
      <span class="badge" id="statusBadge">Activé</span>
      <span aria-hidden="true">⚙️</span>
    </div>
  </header>

  <div class="tabs" role="tablist" aria-label="Sections">
    <div class="tab" role="tab" id="tab-general" aria-selected="true" aria-controls="panel-general" tabindex="0">Général</div>
    <div class="tab" role="tab" id="tab-lecture" aria-selected="false" aria-controls="panel-lecture" tabindex="-1">Lecture</div>
    <div class="tab" role="tab" id="tab-outils" aria-selected="false" aria-controls="panel-outils" tabindex="-1">Outils</div>
  </div>

  <main>
    <section class="card" id="panel-general" role="tabpanel" aria-labelledby="tab-general">
      <h3>Extension</h3>
      <div class="row" role="group" aria-label="Activation de l’extension">
        <div class="stack">
          <span class="label" id="lbl-enabled">Activer BetterCrunchy</span>
          <span class="hint" id="hint-enabled">Active/Désactive toutes les personnalisations</span>
        </div>
        <label class="switch" aria-labelledby="lbl-enabled" aria-describedby="hint-enabled">
          <input id="extEnabled" type="checkbox" role="switch" aria-checked="false">
          <span class="slider"></span>
        </label>
      </div>
    </section>

    <section class="card" aria-labelledby="sec-tweaks">
      <h3 id="sec-tweaks">Ajustements</h3>
      <div class="row">
        <div class="stack">
          <span class="label" id="lbl-colorTitles">Titres colorés</span>
          <span class="hint">Ajoute une couleur d’accent aux titres</span>
        </div>
        <label class="switch" aria-labelledby="lbl-colorTitles">
          <input id="colorTitles" type="checkbox" role="switch">
          <span class="slider"></span>
        </label>
      </div>

      <div class="row">
        <div class="stack">
          <span class="label" id="lbl-autoHideHeader">Masquer l’entête</span>
          <span class="hint">Réduit l’entête automatiquement pendant la lecture</span>
        </div>
        <label class="switch" aria-labelledby="lbl-autoHideHeader">
          <input id="autoHideHeader" type="checkbox" role="switch">
          <span class="slider"></span>
        </label>
      </div>

      <div class="row-grid">
        <label class="label" for="theme">Thème</label>
        <select id="theme">
          <option value="default">Crunchy</option>
          <option value="dark">Sombre++</option>
          <option value="light">Clair</option>
        </select>
      </div>

      <div class="row-grid">
        <label class="label" for="accentColor">Couleur d’accent</label>
        <input id="accentColor" type="color">
      </div>
    </section>

    <section class="card" id="panel-lecture" role="tabpanel" aria-labelledby="tab-lecture" hidden>
      <h3>Lecture</h3>
      <div class="row">
        <div class="stack">
          <span class="label" id="lbl-autoSkip">Auto-skip intro/outro</span>
          <span class="hint">Passe automatiquement les génériques quand détectés</span>
        </div>
        <label class="switch" aria-labelledby="lbl-autoSkip">
          <input id="autoSkip" type="checkbox" role="switch">
          <span class="slider"></span>
        </label>
      </div>

      <div class="row">
        <div class="stack">
          <span class="label" id="lbl-autoNext">Épisode suivant auto</span>
          <span class="hint">Lance le prochain épisode après un délai</span>
        </div>
        <label class="switch" aria-labelledby="lbl-autoNext">
          <input id="autoNext" type="checkbox" role="switch" aria-controls="autoNextDelayRow">
          <span class="slider"></span>
        </label>
      </div>

      <div id="autoNextDelayRow" class="row" style="display:none;">
        <span class="label">Délai ( <span id="delayLabel">5</span>s )</span>
        <input id="autoNextDelay" type="range" min="3" max="15" value="5" aria-valuemin="3" aria-valuemax="15">
      </div>
    </section>

    <section class="card" id="panel-outils" role="tabpanel" aria-labelledby="tab-outils" hidden>
      <h3>Statistiques</h3>
      <p style="margin:6px 0 10px;">Temps total: <strong id="statTime">0h 0m</strong></p>
      <div class="row" style="gap:8px;">
        <button id="statSimulate" class="btn success">+5 min (test)</button>
        <button id="statReset" class="btn danger">Réinitialiser</button>
      </div>

      <div class="divider"></div>

      <h3>Outils</h3>
      <button id="testEpisodeNotif" class="btn primary">Tester la notification d’épisode</button>
      <button id="savePage" class="btn primary">Capturer la page</button>
    </section>
  </main>

  <footer>
    <span id="version">v1.0</span>
    <a class="link" href="https://github.com/" target="_blank" rel="noopener noreferrer">README</a>
  </footer>

  <script src="popup.js"></script>
  <script>
    // Lightweight tab handling to avoid touching popup.js logic
    (function(){
      const tabs=[...document.querySelectorAll('.tab')];
      const panels={
        'tab-general':document.getElementById('panel-general'),
        'tab-lecture':document.getElementById('panel-lecture'),
        'tab-outils':document.getElementById('panel-outils')
      };
      function activate(id){
        tabs.forEach(t=>{
          const sel=t.id===id;
          t.setAttribute('aria-selected', sel);
          t.tabIndex = sel?0:-1;
          panels[t.id].hidden = !sel;
        });
      }
      tabs.forEach(t=>t.addEventListener('click',()=>activate(t.id)));
      tabs.forEach(t=>t.addEventListener('keydown',e=>{
        if(e.key==='ArrowRight'||e.key==='ArrowLeft'){
          const i=tabs.indexOf(document.activeElement);const dir=e.key==='ArrowRight'?1:-1;
          const next=(i+dir+tabs.length)%tabs.length;tabs[next].focus();activate(tabs[next].id);
        }
      }));

      // Reflect enabled status in badge
      const enabledEl=document.getElementById('extEnabled');
      const badge=document.getElementById('statusBadge');
      const updateBadge=()=>{badge.textContent=enabledEl?.checked? 'Activé':'Désactivé';badge.style.background=enabledEl?.checked?'rgba(39,195,123,.25)':'rgba(255,77,77,.25)';}
      document.addEventListener('DOMContentLoaded',()=>updateBadge());
      const obs=new MutationObserver(updateBadge);
      if(enabledEl) obs.observe(enabledEl,{attributes:true,attributeFilter:['checked']});
    })();
  </script>
</body>
</html>
